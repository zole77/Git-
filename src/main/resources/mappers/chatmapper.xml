<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycom.ussum.repository.ChatRepository">
    <insert id="createRoom">
        <![CDATA[
            INSERT INTO CHAT_TABLE(ROOM_ID, ROOM_NAME)
            VALUES (ROOM_ID = #{room_id}, ROOM_NAME = #{room_name})
        ]]>
    </insert>

    <insert id="saveMsg">
        INSERT INTO MESSAGE_TABLE(ROOM_ID, CHAT_NO, MESSAGE, MEM_ID, TYPE)
        VALUES (ROOM_ID=#{room_id},
                (SELECT count(*) + 1
                 FROM MESSAGE_TABLE
                 WHERE ROOM_ID = #{room_id}),
                MESSAGE = #{message},
                MEM_ID = #{mem_id},
                TYPE = #{type})
    </insert>

    <select id="getMsg" resultType="com.mycom.ussum.vo.ChatMessage">
        SELECT MESSAGE, MEM_ID, TYPE
        FROM MESSAGE_TABLE
        WHERE ROOM_ID = #{room_id}
        ORDER BY CHAT_NO
    </select>
</mapper>